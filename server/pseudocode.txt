PROGRAM client
  CONNECT to control socket

  IF action is "GET":
    send get msg to server
  ELSE IF action is "SEND":
    send send msg to server
  ELSE IF action is "CLOSE":
    send close msg to server

  LOOP
    IF "SEND_SOCKET_READY" msg:
      CONNECT to data socket
      OPEN file as read
      LOOP
        send data msgs
      EXIT
    ELSE IF GET_SOCKET_READY msg:
      CONNECT to data socket
      LOOP
        send data msgs
      EXIT
END

PROGRAM server
  FUNCTION control_channel:
    BIND socket
    LISTEN socket
    LOOP
      ACCEPT socket connections
      RECEIVE action msgs
      CALL data_channel()
      IF action == "CLOSE"
        CLOSE socket
        EXIT
  ENDFUNCTION

  FUNCTION data_channel:
    BIND socket
    LISTEN socket
    IF msg == "GET":
      ACCEPT socket connections
      SEND msg to server that data socket open
      OPEN file
        LOOP
          send msgs
      CLOSE socket connections

    ELSE IF msg == "SEND":
      ACCEPT socket connections
      SEND msg to server that data socket open
      RECEIVE file msgs
      OPEN file
        write file msg
      CLOSE socket connections
  ENDFUNCTION
END